  <div class="container">
  <p id="notice"><%= notice %></p>

  <h1>Atividades cadastradas</h1>

  <% if policy(@activities).index? %>

  <div class="botao_volta">
    <%= link_to 'Menu Inicial', welcome_index_path, :class => "btn btn-primary"  %>
  </div>

  <%= form_tag(activities_path, method: :get, class: "form-group")  do %>
    <%= text_field_tag :search, params[:search], class: "form-control text_form", placeholder: 'Pesquise por uma atividade!' %>
    <%= submit_tag ("Procurar"), class: "form-control button_form"%>
  <% end %>

  <small style="color:purple">
    O campo de pesquisa não se aplica aos campos:
    <b>Horas Computadas</b> e <b>Data do Evento</b>
  </small>

  <% if params['status'] == 'pendentes' || params['status'] == 'deferidos' ||
        params['status'] == 'indeferidos' || params['status'] == 'revisar' || params['status'].nil? %>
    <ul class="nav nav-tabs">
      <li class="nav-item">
        <% if params['status'] == 'pendentes' || params['status'].nil? %>
          <%= link_to "Pendentes", activities_path(:status => 'pendentes'), class: 'nav-link active' %>
        <% else %>
          <%= link_to "Pendentes", activities_path(:status => 'pendentes'), class: 'nav-link' %>
        <% end %>
      </li>

      <li class="nav-item">
        <% if params['status'] == 'deferidos' %>
          <%= link_to "Deferidos", activities_path(:status => 'deferidos'), class: 'nav-link active' %>
        <% else %>
          <%= link_to "Deferidos", activities_path(:status => 'deferidos'), class: 'nav-link' %>
        <% end %>
      </li>

      <li class="nav-item">
        <% if params['status'] == 'indeferidos' %>
          <%= link_to "Indeferidos", activities_path(:status => 'indeferidos'), class: 'nav-link active' %>
        <% else %>
          <%= link_to "Indeferidos", activities_path(:status => 'indeferidos'), class: 'nav-link' %>
        <% end %>
      </li>

      <li class="nav-item">
        <% if params['status'] == 'revisar' %>
          <%= link_to "A revisar", activities_path(:status => 'revisar'), class: 'nav-link active' %>
        <% else %>
          <%= link_to "A revisar", activities_path(:status => 'revisar'), class: 'nav-link' %>
        <% end %>
      </li>
    </ul>

    <% if params['status'].present? %>
      <%= render params['status'], activity: @activity %>
    <% else %>
      <%= render 'pendentes', activity: @activity %>
    <% end %>

  <% else %>
    <%= render 'pendentes', activity: @activity %>
  <% end %>

  <br>

  <% else %>
  <div class="col-md-12 row" onmouseover="index_activities_slide()">
    <div class="col-md-3">
      <%= link_to 'Cadastrar Atividade', new_activity_path, :class => "btn btn-danger slide3"  %>
    </div>

    <div class="col-md-3">
      <%= link_to 'Exibir horas cadastradas', activities_horas_path, target: "_blank", :class => "btn btn-primary slide1" %>
    </div>

    <div class="col-md-3">
      <%= link_to 'Gerar Relatório Completo', export_activity_path(current_user), target: "_blank", :class => "btn btn-primary slide2"  %>
    </div>

    <div class="col-md-3">
      <%= link_to 'Voltar ao menu inicial', welcome_index_path, :class => "btn btn-warning voltar"  %>
    </div>
  </div>

  <div class="col-md-12 info_index row">
    <div class="col-md-3">
      <div class="slidedown3" style="display:none;">
        <small style="color:red">Clique em <b>Cadastrar Atividade</b> para cadastrar uma nova atividade para aprovação.</small>
          <ul>
            <small style="color:#8B0000"><li>Ao cadastrar uma atividade, ela ficara com o status <i>Pendente</i>. Isso indica que já foi encaminhada
              para o(a) avaliador(a), e necessita passar pela avaliação do(a) mesmo(a).</li></small>
            <small style="color:#8B0000"><li>Ao passar pela avaliação e o(a) avaliador(a) salvar a avaliação, a atividade assumirá o status de <i>Deferido (Atividade é contabilizada na <b>Tabela de Horas</b>)</i>,
              <i>Indeferido (Atividade não é contabilizada na <b>Tabela de Horas</b>)</i>, ou <i>Revisar (Avaliador(a) coloca atividade em "espera" para posterior revisão da mesma)</i>.</li></small>
            <small style="color:#8B0000"><li>Ao ser avaliada, são preenchidos os campos 'Profissional Responsável' com o nome do(a) profissional(a) que realizou a avaliação,
              e 'Observação do profissional' com o feedback dado pelo(a) avaliador(a).</li></small>
          </ul>
      </div>
    </div>

    <div class="col-md-3">
      <div class="slidedown1" style="display:none;">
        <small style="color: green">Clique em <b>Exibir horas cadastradas</b> para visualizar as todas horas contabilizadas,
          e em que foram contabilizadas.</small>
      </div>
    </div>

    <div class="col-md-3">
      <div class="slidedown2" style="display:none;">
        <small style="color:blue">Clique em <b>Gerar Relatório Completo</b> para visualizar toda a tabela de horas Deferidas, contabilizadas,
        e todos os pedidos de cadastro de horas feitos até hoje, <u>em PDF</u>.</small>
      </div>
    </div>
  </div>


  <%= form_tag(activities_path, method: :get, class: "form-group")  do %>
    <%= text_field_tag :search, params[:search], class: "form-control text_form", placeholder: 'Pesquise por uma atividade!' %>
    <%= submit_tag ("Procurar"), class: "form-control button_form"%>
  <% end %>

  <small style="color:purple;">
    O campo de pesquisa não se aplica aos campos:
    <b>Horas Computadas</b> e <b>Data do Evento</b>
  </small>

  <table class="table table-hover">
    <thead>
      <tr>
        <th>Título</th>
        <th>Grupo</th>
        <th>Horas computadas</th>
        <th>Data do evento</th>
        <th>Instituição / Evento</th>
        <th>Relatório de Atividade</th>
        <th>Status</th>
        <th>Profissional responsavel</th>
        <th>Observação do profissional</th>
        <% if current_user.role == "admin" %>
        <th>Ação</th>
        <% else %>
        <th colspan="3">Ação</th>
        <% end %>
      </tr>
    </thead>

    <tbody>
      <% if @atividades_cadastradas == 0 %>
        <hr />
        <h4>Não existem atividades cadastradas ainda!</h4>
      <% end %>

      <% @activities.each do |activity| %>
        <tr>
          <td class="titulo"><p><%= activity.titulo %></p></td>
          <td class="grupo"><p><%= activity.nome_grupo %></p></td>
          <td><%= activity.hora_computada %></td>
          <td><%= activity.data_evento %></td>
          <td><%= activity.local_realizacao_atividade %> / <%= activity.nome_do_evento %></td>
          <td class="relatorio"><p><%= activity.relatorio %></p></td>
          <td><%= activity.status %></td>
          <td><%= activity.edited_by %></td>
          <td><%= activity.feedback %></td>
          <% if activity.status == "Deferido" || activity.status == "Indeferido"%>
          <td><%= link_to 'Exibir', activity %></td>
          <td></td>
          <td></td>
          <% elsif activity.status == "Pendente" %>
            <td><%= link_to 'Exibir', activity %></td>
            <td><%= link_to 'Editar', edit_activity_path(activity) %></td>
            <td><%= link_to 'Apagar', delete_path(id: activity), data: { confirm: 'Tem certeza?' } %></td>
          <% elsif activity.status == "Revisar" %>
            <td><%= link_to 'Exibir', activity %></td>
            <td><%= link_to 'Editar', edit_activity_path(activity) %></td>
            <td></td>
          <% end %>
        </tr>
      <% end %>
    </tbody>
  </table>

  <% end %>
</div>

<style type="text/css">
  .nav-tabs {
    font-size: 1em;
    padding: 5px;
  }
  .nav-link:hover {
    background:none;
  }
  .text_form {
    width:80%;
  }
  .botao_volta {
    margin-bottom: 10px;
  }
  .button_form {
    width:15%;
  }
  .text_form, .button_form {
    display: inline-block;
  }
  .slidedown1, .slidedown2, .slidedown3 {
    height:250px;
    width:150px;
    background-color:rgba(230,230,230,0.6);
    border-radius:15px;
    margin-top:-25px;
    margin-left:30px;
    padding:20px;
  }
  .slidedown3 {
    margin-left:-15px;
    width:500px;
  }
  .slidedown2 {
    height:300px;
  }
  .slide1, .slide2, .slide3, .voltar {
    color: black!important;
    background-color:white;
  }
  td , th {
    border:1px solid black;
    text-align:center;
  }
  table {
    border:2px solid black;
    text-align: center;
    margin-top:-5px;
  }
  td p {
    white-space: nowrap;
    width: 70px;
    overflow: hidden;
    text-overflow:  ellipsis;
  }
  .table_admin {
    margin-left:-70px;
  }
  td > a:hover {
    background:none;
    text-decoration:none;
    color:black;
  }
  .col-md-3 {
    margin-bottom:30px;
  }
  .col-md-3 > a {
    margin-left:-15px;
  }


  @media (max-width: 575.98px) {
    .button_form {
      width:100px;
    }
  }

  @media (max-width: 767.98px) {
    .grupo p {
      white-space: nowrap!important;
      width: 150px!important;
      overflow: hidden!important;
      text-overflow:  ellipsis!important;
      text-align: center!important;
      margin-left:33%;
    }
    .table_admin {
      margin-left:-10px;
    }
  }
</style>
